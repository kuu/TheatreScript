<!DOCTYPE html>
<html>
  <head>
    <title>Samples</title>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <script type="text/javascript" src="../bin/theatrescript.js"></script>
    <script type="text/javascript">
    //![CDATA[

    var mWidth = innerWidth,
    mHeight = innerHeight,
    mNumber = 100;

    function onMove(e) {
      this.vX = (Math.random() * mWidth * .05 | 0) - (mWidth * .025);
      this.vY = (Math.random() * mHeight * .05 | 0) - (mHeight * .025);
      this.stepsLeft = this.stage.timeToStep('1s');
      this.ignore('update', onUpdate).listen('update', onUpdate);
    }

    function onUpdate() {
      this.x += this.vX;
      this.y += this.vY;

      if (this.x <= 0) this.x = 0;
      if (this.y <= 0) this.y = 0;
      if (this.x >= mWidth - this.width) this.x = mWidth - this.width;
      if (this.y >= mHeight - this.height) this.y = mHeight - this.height;

      this.parent.invalidate();

      if (!(--this.stepsLeft)) {
        this.ignore('update', onUpdate);
      }
    }

    var DOMActor = theatre.crews.dom.DOMActor;
    var CanvasActor = theatre.crews.canvas.CanvasActor;
    var BoxActor = theatre.createActor('BoxActor', CanvasActor, function(pData) {
      this.color = pData.color;
    });

    BoxActor.prototype.draw = function(pContext) {
      pContext.fillStyle = this.color;
      pContext.fillRect(0, 0, this.width, this.height);
    };

    var tStage = new theatre.Stage();

    tStage.stageManager.listen('enterstep', function startup() {
        this.ignore('enterstep', startup);
        var random = Math.random;
        var tContainer = document.getElementById('container');

        var tContainerActor = this.addActor(DOMActor, {
          container: tContainer
        });

        tContainerActor = tContainerActor.addActor(CanvasActor, {
          width: mWidth,
          height: mHeight
        });

        for (var i = 0; i < mNumber; i++) {
          var tActor = tContainerActor.addActor(BoxActor, {
            width: random() * mWidth * .05 | 0,
            height: random() * mHeight * .05 | 0,
            color: '#'
                + (random() * 15 | 0).toString(16)
                + (random() * 15 | 0).toString(16)
                + (random() * 15 | 0).toString(16)
          });
          tActor.listen('move', onMove);
          tActor.x = (random() * mWidth - tActor.width) | 0;
          tActor.y = (random() * mHeight - tActor.height) | 0;
        }
    });

    document.addEventListener('click', function() {
      tStage.cue('move');
    }, false);

    tStage.open();

    //]]>
    </script>
  </head>
  <body style="margin:0;padding:0">
    <div id="container"></div>
  </body>
</html>
